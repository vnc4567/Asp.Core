∞
RC:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\DependencyInjection.cs
	namespace 	
Infrastructure
 
{ 
public 

static 
class 
DependencyInjection +
{ 
public 
static 
readonly 
ILoggerFactory -
MyLoggerFactory. =
=> ?
LoggerFactory@ M
.M N
CreateN T
(T U
builderU \
=>] _
{ 	
builder 
. 
	AddFilter 
( 
( 
category $
,$ %
level& +
)+ ,
=>- /
category 
== 
DbLoggerCategory  0
.0 1
Database1 9
.9 :
Command: A
.A B
NameB F
&& 
level 
== 
LogLevel  (
.( )
Debug) .
). /
. 
AddNLog 
( 
) 
; 
} 	
)	 

;
 
public 
static 
IServiceCollection (
AddPersistence) 7
(7 8
this8 <
IServiceCollection= O
servicesP X
,X Y
IConfigurationZ h
configurationi v
)v w
{ 	
var 
currentAssembly 
=  !
Assembly" *
.* + 
GetExecutingAssembly+ ?
(? @
)@ A
;A B
services 
. 
AddDbContext !
<! "
TestContext" -
>- .
(. /
options/ 6
=>7 9
options 
. 
UseLoggerFactory $
($ %
MyLoggerFactory% 4
)4 5
. 
UseSqlServer 
( 
configuration '
.' (
GetConnectionString( ;
(; <
$str< J
)J K
)K L
)L M
;M N
services 
. 3
'RegisterAssemblyPublicNonGenericClasses <
(< =
currentAssembly= L
)L M
.   
Where   
(   
c   
=>   
c   
.   
Name   !
.  ! "
EndsWith  " *
(  * +
$str  + 7
)  7 8
)  8 9
.!! )
AsPublicImplementedInterfaces!! -
(!!- .
)!!. /
;!!/ 0
services## 
.## 3
'RegisterAssemblyPublicNonGenericClasses## <
(##< =
currentAssembly##= L
)##L M
.$$ 
Where$$ 
($$ 
c$$ 
=>$$ 
c$$ 
.$$ 
Name$$ "
.$$" #
EndsWith$$# +
($$+ ,
$str$$, 5
)$$5 6
)$$6 7
.%% )
AsPublicImplementedInterfaces%% .
(%%. /
)%%/ 0
;%%0 1
services'' 
.'' 
	AddScoped'' 
<'' 
ITestDbContext'' -
>''- .
(''. /
provider''/ 7
=>''8 :
provider''; C
.''C D

GetService''D N
<''N O
TestContext''O Z
>''Z [
(''[ \
)''\ ]
)''] ^
;''^ _
return(( 
services(( 
;(( 
})) 	
}** 
}++ «	
VC:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\MailService\MailService.cs
	namespace 	
Infrastructure
 
. 
MailService $
{ 
public		 

class		 
MailService		 
:		 
IMailService		 +
{

 
public 
void 
SendEmailAsync "
(" #
string# )
	recipient* 3
,3 4
string5 ;
body< @
)@ A
{ 	

SmtpClient 
client 
= 
new  #

SmtpClient$ .
(. /
)/ 0
;0 1
client 
. 
DeliveryMethod !
=" #
SmtpDeliveryMethod$ 6
.6 7$
SpecifiedPickupDirectory %
;% &
client 
. #
PickupDirectoryLocation *
=+ ,
$str- 7
;7 8
client 
. 
Send 
( 
$str (
,( )
	recipient) 2
,2 3
$str '
,' (
body 
) 
; 
} 	
} 
} §
]C:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\Migrations\20200204130913_Init.cs
	namespace 	
Infrastructure
 
. 

Migrations #
{ 
public 

partial 
class 
Init 
: 
	Migration  )
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
CreateTable		 (
(		( )
name

 
:

 
$str

 
,

 
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
int& )
>) *
(* +
nullable+ 3
:3 4
false5 :
): ;
. 

Annotation #
(# $
$str$ 8
,8 9
$str: @
)@ A
,A B
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
nullable0 8
:8 9
true: >
)> ?
,? @
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
	maxLength1 :
:: ;
$num< >
,> ?
nullable@ H
:H I
trueJ N
)N O
,O P
Age 
= 
table 
.  
Column  &
<& '
int' *
>* +
(+ ,
	maxLength, 5
:5 6
$num7 9
,9 :
nullable; C
:C D
falseE J
)J K
,K L
Adresse 
= 
table #
.# $
Column$ *
<* +
string+ 1
>1 2
(2 3
nullable3 ;
:; <
true= A
)A B
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 0
,0 1
x2 3
=>4 6
x7 8
.8 9
Id9 ;
); <
;< =
} 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
	DropTable &
(& '
name 
: 
$str 
) 
;  
} 	
} 
}   Å
^C:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\Migrations\20200205143606_dbset.cs
	namespace 	
Infrastructure
 
. 

Migrations #
{ 
public 

partial 
class 
dbset 
:  
	Migration! *
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
DropPrimaryKey		 +
(		+ ,
name

 
:

 
$str

 !
,

! "
table 
: 
$str 
)  
;  !
migrationBuilder 
. 
RenameTable (
(( )
name 
: 
$str 
, 
newName 
: 
$str "
)" #
;# $
migrationBuilder 
. 
AddPrimaryKey *
(* +
name 
: 
$str "
," #
table 
: 
$str  
,  !
column 
: 
$str 
) 
; 
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 
DropPrimaryKey +
(+ ,
name 
: 
$str "
," #
table 
: 
$str  
)  !
;! "
migrationBuilder 
. 
RenameTable (
(( )
name 
: 
$str 
,  
newName 
: 
$str !
)! "
;" #
migrationBuilder!! 
.!! 
AddPrimaryKey!! *
(!!* +
name"" 
:"" 
$str"" !
,""! "
table## 
:## 
$str## 
,##  
column$$ 
:$$ 
$str$$ 
)$$ 
;$$ 
}%% 	
}&& 
}'' é≤
aC:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\Migrations\20200211083013_identity.cs
	namespace 	
Infrastructure
 
. 

Migrations #
{ 
public 

partial 
class 
identity !
:" #
	Migration$ -
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{		 	
migrationBuilder

 
.

 
CreateTable

 (
(

( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
Name 
= 
table  
.  !
Column! '
<' (
string( .
>. /
(/ 0
	maxLength0 9
:9 :
$num; >
,> ?
nullable@ H
:H I
trueJ N
)N O
,O P
NormalizedName "
=# $
table% *
.* +
Column+ 1
<1 2
string2 8
>8 9
(9 :
	maxLength: C
:C D
$numE H
,H I
nullableJ R
:R S
trueT X
)X Y
,Y Z
ConcurrencyStamp $
=% &
table' ,
., -
Column- 3
<3 4
string4 :
>: ;
(; <
nullable< D
:D E
trueF J
)J K
} 
, 
constraints 
: 
table "
=># %
{ 
table 
. 

PrimaryKey $
($ %
$str% 5
,5 6
x7 8
=>9 ;
x< =
.= >
Id> @
)@ A
;A B
} 
) 
; 
migrationBuilder 
. 
CreateTable (
(( )
name 
: 
$str #
,# $
columns 
: 
table 
=> !
new" %
{ 
Id 
= 
table 
. 
Column %
<% &
string& ,
>, -
(- .
nullable. 6
:6 7
false8 =
)= >
,> ?
UserName 
= 
table $
.$ %
Column% +
<+ ,
string, 2
>2 3
(3 4
	maxLength4 =
:= >
$num? B
,B C
nullableD L
:L M
trueN R
)R S
,S T
NormalizedUserName &
=' (
table) .
.. /
Column/ 5
<5 6
string6 <
>< =
(= >
	maxLength> G
:G H
$numI L
,L M
nullableN V
:V W
trueX \
)\ ]
,] ^
Email 
= 
table !
.! "
Column" (
<( )
string) /
>/ 0
(0 1
	maxLength1 :
:: ;
$num< ?
,? @
nullableA I
:I J
trueK O
)O P
,P Q
NormalizedEmail   #
=  $ %
table  & +
.  + ,
Column  , 2
<  2 3
string  3 9
>  9 :
(  : ;
	maxLength  ; D
:  D E
$num  F I
,  I J
nullable  K S
:  S T
true  U Y
)  Y Z
,  Z [
EmailConfirmed!! "
=!!# $
table!!% *
.!!* +
Column!!+ 1
<!!1 2
bool!!2 6
>!!6 7
(!!7 8
nullable!!8 @
:!!@ A
false!!B G
)!!G H
,!!H I
PasswordHash""  
=""! "
table""# (
.""( )
Column"") /
<""/ 0
string""0 6
>""6 7
(""7 8
nullable""8 @
:""@ A
true""B F
)""F G
,""G H
SecurityStamp## !
=##" #
table##$ )
.##) *
Column##* 0
<##0 1
string##1 7
>##7 8
(##8 9
nullable##9 A
:##A B
true##C G
)##G H
,##H I
ConcurrencyStamp$$ $
=$$% &
table$$' ,
.$$, -
Column$$- 3
<$$3 4
string$$4 :
>$$: ;
($$; <
nullable$$< D
:$$D E
true$$F J
)$$J K
,$$K L
PhoneNumber%% 
=%%  !
table%%" '
.%%' (
Column%%( .
<%%. /
string%%/ 5
>%%5 6
(%%6 7
nullable%%7 ?
:%%? @
true%%A E
)%%E F
,%%F G 
PhoneNumberConfirmed&& (
=&&) *
table&&+ 0
.&&0 1
Column&&1 7
<&&7 8
bool&&8 <
>&&< =
(&&= >
nullable&&> F
:&&F G
false&&H M
)&&M N
,&&N O
TwoFactorEnabled'' $
=''% &
table''' ,
.'', -
Column''- 3
<''3 4
bool''4 8
>''8 9
(''9 :
nullable'': B
:''B C
false''D I
)''I J
,''J K

LockoutEnd(( 
=((  
table((! &
.((& '
Column((' -
<((- .
DateTimeOffset((. <
>((< =
(((= >
nullable((> F
:((F G
true((H L
)((L M
,((M N
LockoutEnabled)) "
=))# $
table))% *
.))* +
Column))+ 1
<))1 2
bool))2 6
>))6 7
())7 8
nullable))8 @
:))@ A
false))B G
)))G H
,))H I
AccessFailedCount** %
=**& '
table**( -
.**- .
Column**. 4
<**4 5
int**5 8
>**8 9
(**9 :
nullable**: B
:**B C
false**D I
)**I J
}++ 
,++ 
constraints,, 
:,, 
table,, "
=>,,# %
{-- 
table.. 
... 

PrimaryKey.. $
(..$ %
$str..% 5
,..5 6
x..7 8
=>..9 ;
x..< =
...= >
Id..> @
)..@ A
;..A B
}// 
)// 
;// 
migrationBuilder11 
.11 
CreateTable11 (
(11( )
name22 
:22 
$str22 (
,22( )
columns33 
:33 
table33 
=>33 !
new33" %
{44 
Id55 
=55 
table55 
.55 
Column55 %
<55% &
int55& )
>55) *
(55* +
nullable55+ 3
:553 4
false555 :
)55: ;
.66 

Annotation66 #
(66# $
$str66$ 8
,668 9
$str66: @
)66@ A
,66A B
RoleId77 
=77 
table77 "
.77" #
Column77# )
<77) *
string77* 0
>770 1
(771 2
nullable772 :
:77: ;
false77< A
)77A B
,77B C
	ClaimType88 
=88 
table88  %
.88% &
Column88& ,
<88, -
string88- 3
>883 4
(884 5
nullable885 =
:88= >
true88? C
)88C D
,88D E

ClaimValue99 
=99  
table99! &
.99& '
Column99' -
<99- .
string99. 4
>994 5
(995 6
nullable996 >
:99> ?
true99@ D
)99D E
}:: 
,:: 
constraints;; 
:;; 
table;; "
=>;;# %
{<< 
table== 
.== 

PrimaryKey== $
(==$ %
$str==% :
,==: ;
x==< =
=>==> @
x==A B
.==B C
Id==C E
)==E F
;==F G
table>> 
.>> 

ForeignKey>> $
(>>$ %
name?? 
:?? 
$str?? F
,??F G
column@@ 
:@@ 
x@@  !
=>@@" $
x@@% &
.@@& '
RoleId@@' -
,@@- .
principalTableAA &
:AA& '
$strAA( 5
,AA5 6
principalColumnBB '
:BB' (
$strBB) -
,BB- .
onDeleteCC  
:CC  !
ReferentialActionCC" 3
.CC3 4
CascadeCC4 ;
)CC; <
;CC< =
}DD 
)DD 
;DD 
migrationBuilderFF 
.FF 
CreateTableFF (
(FF( )
nameGG 
:GG 
$strGG (
,GG( )
columnsHH 
:HH 
tableHH 
=>HH !
newHH" %
{II 
IdJJ 
=JJ 
tableJJ 
.JJ 
ColumnJJ %
<JJ% &
intJJ& )
>JJ) *
(JJ* +
nullableJJ+ 3
:JJ3 4
falseJJ5 :
)JJ: ;
.KK 

AnnotationKK #
(KK# $
$strKK$ 8
,KK8 9
$strKK: @
)KK@ A
,KKA B
UserIdLL 
=LL 
tableLL "
.LL" #
ColumnLL# )
<LL) *
stringLL* 0
>LL0 1
(LL1 2
nullableLL2 :
:LL: ;
falseLL< A
)LLA B
,LLB C
	ClaimTypeMM 
=MM 
tableMM  %
.MM% &
ColumnMM& ,
<MM, -
stringMM- 3
>MM3 4
(MM4 5
nullableMM5 =
:MM= >
trueMM? C
)MMC D
,MMD E

ClaimValueNN 
=NN  
tableNN! &
.NN& '
ColumnNN' -
<NN- .
stringNN. 4
>NN4 5
(NN5 6
nullableNN6 >
:NN> ?
trueNN@ D
)NND E
}OO 
,OO 
constraintsPP 
:PP 
tablePP "
=>PP# %
{QQ 
tableRR 
.RR 

PrimaryKeyRR $
(RR$ %
$strRR% :
,RR: ;
xRR< =
=>RR> @
xRRA B
.RRB C
IdRRC E
)RRE F
;RRF G
tableSS 
.SS 

ForeignKeySS $
(SS$ %
nameTT 
:TT 
$strTT F
,TTF G
columnUU 
:UU 
xUU  !
=>UU" $
xUU% &
.UU& '
UserIdUU' -
,UU- .
principalTableVV &
:VV& '
$strVV( 5
,VV5 6
principalColumnWW '
:WW' (
$strWW) -
,WW- .
onDeleteXX  
:XX  !
ReferentialActionXX" 3
.XX3 4
CascadeXX4 ;
)XX; <
;XX< =
}YY 
)YY 
;YY 
migrationBuilder[[ 
.[[ 
CreateTable[[ (
([[( )
name\\ 
:\\ 
$str\\ (
,\\( )
columns]] 
:]] 
table]] 
=>]] !
new]]" %
{^^ 
LoginProvider__ !
=__" #
table__$ )
.__) *
Column__* 0
<__0 1
string__1 7
>__7 8
(__8 9
nullable__9 A
:__A B
false__C H
)__H I
,__I J
ProviderKey`` 
=``  !
table``" '
.``' (
Column``( .
<``. /
string``/ 5
>``5 6
(``6 7
nullable``7 ?
:``? @
false``A F
)``F G
,``G H
ProviderDisplayNameaa '
=aa( )
tableaa* /
.aa/ 0
Columnaa0 6
<aa6 7
stringaa7 =
>aa= >
(aa> ?
nullableaa? G
:aaG H
trueaaI M
)aaM N
,aaN O
UserIdbb 
=bb 
tablebb "
.bb" #
Columnbb# )
<bb) *
stringbb* 0
>bb0 1
(bb1 2
nullablebb2 :
:bb: ;
falsebb< A
)bbA B
}cc 
,cc 
constraintsdd 
:dd 
tabledd "
=>dd# %
{ee 
tableff 
.ff 

PrimaryKeyff $
(ff$ %
$strff% :
,ff: ;
xff< =
=>ff> @
newffA D
{ffE F
xffG H
.ffH I
LoginProviderffI V
,ffV W
xffX Y
.ffY Z
ProviderKeyffZ e
}fff g
)ffg h
;ffh i
tablegg 
.gg 

ForeignKeygg $
(gg$ %
namehh 
:hh 
$strhh F
,hhF G
columnii 
:ii 
xii  !
=>ii" $
xii% &
.ii& '
UserIdii' -
,ii- .
principalTablejj &
:jj& '
$strjj( 5
,jj5 6
principalColumnkk '
:kk' (
$strkk) -
,kk- .
onDeletell  
:ll  !
ReferentialActionll" 3
.ll3 4
Cascadell4 ;
)ll; <
;ll< =
}mm 
)mm 
;mm 
migrationBuilderoo 
.oo 
CreateTableoo (
(oo( )
namepp 
:pp 
$strpp '
,pp' (
columnsqq 
:qq 
tableqq 
=>qq !
newqq" %
{rr 
UserIdss 
=ss 
tabless "
.ss" #
Columnss# )
<ss) *
stringss* 0
>ss0 1
(ss1 2
nullabless2 :
:ss: ;
falsess< A
)ssA B
,ssB C
RoleIdtt 
=tt 
tablett "
.tt" #
Columntt# )
<tt) *
stringtt* 0
>tt0 1
(tt1 2
nullablett2 :
:tt: ;
falsett< A
)ttA B
}uu 
,uu 
constraintsvv 
:vv 
tablevv "
=>vv# %
{ww 
tablexx 
.xx 

PrimaryKeyxx $
(xx$ %
$strxx% 9
,xx9 :
xxx; <
=>xx= ?
newxx@ C
{xxD E
xxxF G
.xxG H
UserIdxxH N
,xxN O
xxxP Q
.xxQ R
RoleIdxxR X
}xxY Z
)xxZ [
;xx[ \
tableyy 
.yy 

ForeignKeyyy $
(yy$ %
namezz 
:zz 
$strzz E
,zzE F
column{{ 
:{{ 
x{{  !
=>{{" $
x{{% &
.{{& '
RoleId{{' -
,{{- .
principalTable|| &
:||& '
$str||( 5
,||5 6
principalColumn}} '
:}}' (
$str}}) -
,}}- .
onDelete~~  
:~~  !
ReferentialAction~~" 3
.~~3 4
Cascade~~4 ;
)~~; <
;~~< =
table 
. 

ForeignKey $
($ %
name
ÄÄ 
:
ÄÄ 
$str
ÄÄ E
,
ÄÄE F
column
ÅÅ 
:
ÅÅ 
x
ÅÅ  !
=>
ÅÅ" $
x
ÅÅ% &
.
ÅÅ& '
UserId
ÅÅ' -
,
ÅÅ- .
principalTable
ÇÇ &
:
ÇÇ& '
$str
ÇÇ( 5
,
ÇÇ5 6
principalColumn
ÉÉ '
:
ÉÉ' (
$str
ÉÉ) -
,
ÉÉ- .
onDelete
ÑÑ  
:
ÑÑ  !
ReferentialAction
ÑÑ" 3
.
ÑÑ3 4
Cascade
ÑÑ4 ;
)
ÑÑ; <
;
ÑÑ< =
}
ÖÖ 
)
ÖÖ 
;
ÖÖ 
migrationBuilder
áá 
.
áá 
CreateTable
áá (
(
áá( )
name
àà 
:
àà 
$str
àà (
,
àà( )
columns
ââ 
:
ââ 
table
ââ 
=>
ââ !
new
ââ" %
{
ää 
UserId
ãã 
=
ãã 
table
ãã "
.
ãã" #
Column
ãã# )
<
ãã) *
string
ãã* 0
>
ãã0 1
(
ãã1 2
nullable
ãã2 :
:
ãã: ;
false
ãã< A
)
ããA B
,
ããB C
LoginProvider
åå !
=
åå" #
table
åå$ )
.
åå) *
Column
åå* 0
<
åå0 1
string
åå1 7
>
åå7 8
(
åå8 9
nullable
åå9 A
:
ååA B
false
ååC H
)
ååH I
,
ååI J
Name
çç 
=
çç 
table
çç  
.
çç  !
Column
çç! '
<
çç' (
string
çç( .
>
çç. /
(
çç/ 0
nullable
çç0 8
:
çç8 9
false
çç: ?
)
çç? @
,
çç@ A
Value
éé 
=
éé 
table
éé !
.
éé! "
Column
éé" (
<
éé( )
string
éé) /
>
éé/ 0
(
éé0 1
nullable
éé1 9
:
éé9 :
true
éé; ?
)
éé? @
}
èè 
,
èè 
constraints
êê 
:
êê 
table
êê "
=>
êê# %
{
ëë 
table
íí 
.
íí 

PrimaryKey
íí $
(
íí$ %
$str
íí% :
,
íí: ;
x
íí< =
=>
íí> @
new
ííA D
{
ííE F
x
ííG H
.
ííH I
UserId
ííI O
,
ííO P
x
ííQ R
.
ííR S
LoginProvider
ííS `
,
íí` a
x
ííb c
.
ííc d
Name
ííd h
}
ííi j
)
ííj k
;
íík l
table
ìì 
.
ìì 

ForeignKey
ìì $
(
ìì$ %
name
îî 
:
îî 
$str
îî F
,
îîF G
column
ïï 
:
ïï 
x
ïï  !
=>
ïï" $
x
ïï% &
.
ïï& '
UserId
ïï' -
,
ïï- .
principalTable
ññ &
:
ññ& '
$str
ññ( 5
,
ññ5 6
principalColumn
óó '
:
óó' (
$str
óó) -
,
óó- .
onDelete
òò  
:
òò  !
ReferentialAction
òò" 3
.
òò3 4
Cascade
òò4 ;
)
òò; <
;
òò< =
}
ôô 
)
ôô 
;
ôô 
migrationBuilder
õõ 
.
õõ 
CreateIndex
õõ (
(
õõ( )
name
úú 
:
úú 
$str
úú 2
,
úú2 3
table
ùù 
:
ùù 
$str
ùù )
,
ùù) *
column
ûû 
:
ûû 
$str
ûû  
)
ûû  !
;
ûû! "
migrationBuilder
†† 
.
†† 
CreateIndex
†† (
(
††( )
name
°° 
:
°° 
$str
°° %
,
°°% &
table
¢¢ 
:
¢¢ 
$str
¢¢ $
,
¢¢$ %
column
££ 
:
££ 
$str
££ (
,
££( )
unique
§§ 
:
§§ 
true
§§ 
,
§§ 
filter
•• 
:
•• 
$str
•• 6
)
••6 7
;
••7 8
migrationBuilder
ßß 
.
ßß 
CreateIndex
ßß (
(
ßß( )
name
®® 
:
®® 
$str
®® 2
,
®®2 3
table
©© 
:
©© 
$str
©© )
,
©©) *
column
™™ 
:
™™ 
$str
™™  
)
™™  !
;
™™! "
migrationBuilder
¨¨ 
.
¨¨ 
CreateIndex
¨¨ (
(
¨¨( )
name
≠≠ 
:
≠≠ 
$str
≠≠ 2
,
≠≠2 3
table
ÆÆ 
:
ÆÆ 
$str
ÆÆ )
,
ÆÆ) *
column
ØØ 
:
ØØ 
$str
ØØ  
)
ØØ  !
;
ØØ! "
migrationBuilder
±± 
.
±± 
CreateIndex
±± (
(
±±( )
name
≤≤ 
:
≤≤ 
$str
≤≤ 1
,
≤≤1 2
table
≥≥ 
:
≥≥ 
$str
≥≥ (
,
≥≥( )
column
¥¥ 
:
¥¥ 
$str
¥¥  
)
¥¥  !
;
¥¥! "
migrationBuilder
∂∂ 
.
∂∂ 
CreateIndex
∂∂ (
(
∂∂( )
name
∑∑ 
:
∑∑ 
$str
∑∑ "
,
∑∑" #
table
∏∏ 
:
∏∏ 
$str
∏∏ $
,
∏∏$ %
column
ππ 
:
ππ 
$str
ππ )
)
ππ) *
;
ππ* +
migrationBuilder
ªª 
.
ªª 
CreateIndex
ªª (
(
ªª( )
name
ºº 
:
ºº 
$str
ºº %
,
ºº% &
table
ΩΩ 
:
ΩΩ 
$str
ΩΩ $
,
ΩΩ$ %
column
ææ 
:
ææ 
$str
ææ ,
,
ææ, -
unique
øø 
:
øø 
true
øø 
,
øø 
filter
¿¿ 
:
¿¿ 
$str
¿¿ :
)
¿¿: ;
;
¿¿; <
}
¡¡ 	
	protected
√√ 
override
√√ 
void
√√ 
Down
√√  $
(
√√$ %
MigrationBuilder
√√% 5
migrationBuilder
√√6 F
)
√√F G
{
ƒƒ 	
migrationBuilder
≈≈ 
.
≈≈ 
	DropTable
≈≈ &
(
≈≈& '
name
∆∆ 
:
∆∆ 
$str
∆∆ (
)
∆∆( )
;
∆∆) *
migrationBuilder
»» 
.
»» 
	DropTable
»» &
(
»»& '
name
…… 
:
…… 
$str
…… (
)
……( )
;
……) *
migrationBuilder
ÀÀ 
.
ÀÀ 
	DropTable
ÀÀ &
(
ÀÀ& '
name
ÃÃ 
:
ÃÃ 
$str
ÃÃ (
)
ÃÃ( )
;
ÃÃ) *
migrationBuilder
ŒŒ 
.
ŒŒ 
	DropTable
ŒŒ &
(
ŒŒ& '
name
œœ 
:
œœ 
$str
œœ '
)
œœ' (
;
œœ( )
migrationBuilder
—— 
.
—— 
	DropTable
—— &
(
——& '
name
““ 
:
““ 
$str
““ (
)
““( )
;
““) *
migrationBuilder
‘‘ 
.
‘‘ 
	DropTable
‘‘ &
(
‘‘& '
name
’’ 
:
’’ 
$str
’’ #
)
’’# $
;
’’$ %
migrationBuilder
◊◊ 
.
◊◊ 
	DropTable
◊◊ &
(
◊◊& '
name
ÿÿ 
:
ÿÿ 
$str
ÿÿ #
)
ÿÿ# $
;
ÿÿ$ %
}
ŸŸ 	
}
⁄⁄ 
}€€ »

dC:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\Migrations\20200629124717_AddAdresse2.cs
	namespace 	
Infrastructure
 
. 

Migrations #
{ 
public 

partial 
class 
AddAdresse2 $
:% &
	Migration' 0
{ 
	protected 
override 
void 
Up  "
(" #
MigrationBuilder# 3
migrationBuilder4 D
)D E
{ 	
migrationBuilder		 
.		 
	AddColumn		 &
<		& '
string		' -
>		- .
(		. /
name

 
:

 
$str

  
,

  !
table 
: 
$str  
,  !
nullable 
: 
true 
) 
;  
} 	
	protected 
override 
void 
Down  $
($ %
MigrationBuilder% 5
migrationBuilder6 F
)F G
{ 	
migrationBuilder 
. 

DropColumn '
(' (
name 
: 
$str  
,  !
table 
: 
$str  
)  !
;! "
} 	
} 
} ◊	
mC:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\Persistence\Configurations\PersonConfiguration.cs
	namespace 	
Infrastructure
 
. 
Persistence $
.$ %
Configurations% 3
{ 
public 

class 
PersonConfiguration $
:% &$
IEntityTypeConfiguration' ?
<? @
Person@ F
>F G
{ 
public		 
void		 
	Configure		 
(		 
EntityTypeBuilder		 /
<		/ 0
Person		0 6
>		6 7
builder		8 ?
)		? @
{

 	
builder 
. 
Property 
( 
e 
=> !
e" #
.# $
Email$ )
)) *
.* +
HasMaxLength+ 7
(7 8
$num8 :
): ;
;; <
builder 
. 
Property 
( 
e 
=> !
e" #
.# $
Age$ '
)' (
.( )
HasMaxLength) 5
(5 6
$num6 8
)8 9
;9 :
} 	
} 
} µ
jC:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\Persistence\Repositories\EfPersonRepository.cs
	namespace		 	
Infrastructure		
 
.		 
Persistence		 $
.		$ %
Repositories		% 1
{

 
public 

class 
EfPersonRepository #
:$ %
IPersonRepository& 7
{ 
private 
readonly 
TestContext $
_context% -
;- .
public 
EfPersonRepository !
(! "
TestContext" -
context. 5
)5 6
{ 	
_context 
= 
context 
; 
} 	
public 
async 
Task 
< 
List 
< 
Person %
>% &
>& '
GetAll( .
(. /
)/ 0
{ 	
return 
await 
_context "
." #
Persons# *
.* +
ToListAsync+ 6
(6 7
)7 8
;8 9
} 	
public 
async 
Task 
< 
Person  
>  !
	GetPerson" +
(+ ,
int, /
id0 2
)2 3
{ 	
return 
await 
_context !
.! "
Persons" )
.) * 
SingleOrDefaultAsync* >
(> ?
p? @
=>A C
pD E
.E F
IdF H
==I K
idL N
)N O
;O P
} 	
public 
async 
Task 
< 
IEnumerable %
<% &
Person& ,
>, -
>- .
Find/ 3
(3 4
Specification4 A
<A B
PersonB H
>H I
specificationJ W
)W X
{ 	
return 
await 
_context !
.! "
Persons" )
.) *
Where* /
(/ 0
specification0 =
.= >
ToExpression> J
(J K
)K L
)L M
.M N
ToListAsyncN Y
(Y Z
)Z [
;[ \
}   	
public!! 
async!! 
Task!! 
<!! 
Person!!  
>!!  !
	GetPerson!!" +
(!!+ ,
Specification!!, 9
<!!9 :
Person!!: @
>!!@ A
specification!!B O
)!!O P
{"" 	
return## 
await## 
_context## !
.##! "
Persons##" )
.##) * 
SingleOrDefaultAsync##* >
(##> ?
specification##? L
.##L M
ToExpression##M Y
(##Y Z
)##Z [
)##[ \
;##\ ]
}$$ 	
public%% 
void%% 
Update%% 
(%% 
Person%% !
person%%" (
)%%( )
{&& 	
_context'' 
.'' 
Persons'' 
.'' 
Update'' #
(''# $
person''$ *
)''* +
;''+ ,
_context(( 
.(( 
SaveChanges((  
(((  !
)((! "
;((" #
})) 	
}** 
}++ Õ?
dC:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\Persistence\Repositories\EfRepository.cs
	namespace 	
Infrastructure
 
. 
Persistence $
.$ %
Repositories% 1
{ 
public 

class 
EfRepository 
< 
TEntity %
>% &
:' (
IRepository) 4
<4 5
TEntity5 <
>< =
where 
TEntity 
: 
class "
," #
IEntity$ +
{ 
private 
readonly 
TestContext $
_context% -
;- .
private 
readonly 
DbSet 
< 
TEntity &
>& '
	_entities( 1
;1 2
private 
readonly "
IConfigurationProvider /
_configuration0 >
;> ?
private 

IQueryable 
< 
TEntity "
>" #
_readonlyEntities$ 5
=>6 8
	_entities9 B
.B C
AsNoTrackingC O
(O P
)P Q
;Q R
public 
ICollection 
< 
string !
>! "
Includes# +
{, -
get. 1
;1 2
set3 6
;6 7
}8 9
=: ;
new< ?
List@ D
<D E
stringE K
>K L
(L M
)M N
;N O
public 
EfRepository 
( 
TestContext '
context( /
,/ 0"
IConfigurationProvider1 G
configurationH U
)U V
{ 	
this 
. 
_context 
= 
context #
;# $
this 
. 
	_entities 
= 
context $
.$ %
Set% (
<( )
TEntity) 0
>0 1
(1 2
)2 3
;3 4
_configuration 
= 
configuration *
;* +
} 	
public   
async   
Task   
<   
TEntity   !
>  ! "
AddAsync  # +
(  + ,
TEntity  , 3
entity  4 :
)  : ;
{!! 	
await"" 
_context"" 
."" 
AddAsync"" #
(""# $
entity""$ *
)""* +
;""+ ,
await## 
_context## 
.## 
SaveChangesAsync## +
(##+ ,
)##, -
;##- .
return%% 
entity%% 
;%% 
}&& 	
public(( 
async(( 
Task(( 
<(( 
TEntity(( !
>((! "
	FindAsync((# ,
(((, -

Expression((- 7
<((7 8
Func((8 <
<((< =
TEntity((= D
,((D E
bool((F J
>((J K
>((K L
func((M Q
)((Q R
{)) 	
var** 
query** 
=** 
GenerateQuery** %
(**% &
	_entities**& /
.**/ 0
AsQueryable**0 ;
(**; <
)**< =
,**= >
func**? C
)**C D
;**D E
foreach,, 
(,, 
var,, 
include,,  
in,,! #
Includes,,$ ,
),,, -
{-- 
query.. 
=.. 
query.. 
... 
Include.. %
(..% &
include..& -
)..- .
;... /
}// 
return11 
await11 
query11 
.11  
SingleOrDefaultAsync11 3
(113 4
)114 5
;115 6
}22 	
public55 
void55 
Update55 
(55 
TEntity55 "
user55# '
)55' (
{66 	
	_entities77 
.77 
Update77 
(77 
user77 !
)77! "
;77" #
_context88 
.88 
SaveChanges88  
(88  !
)88! "
;88" #
}99 	
public;; 
async;; 
Task;; 
<;; 
TReturn;; !
>;;! "
FindReadOnlyAsync;;# 4
<;;4 5
TReturn;;5 <
>;;< =
(;;= >

Expression;;> H
<;;H I
Func;;I M
<;;M N
TEntity;;N U
,;;U V
bool;;W [
>;;[ \
>;;\ ]
func;;^ b
);;b c
{<< 	
return== 
await== 
GenerateQuery== &
(==& '
_readonlyEntities==' 8
,==8 9
func==: >
)==> ?
.>> 
	ProjectTo>> 
<>> 
TReturn>> "
>>>" #
(>># $
_configuration>>$ 2
)>>2 3
.>>3 4 
SingleOrDefaultAsync>>4 H
(>>H I
)>>I J
;>>J K
}?? 	
privateAA 

IQueryableAA 
<AA 
TEntityAA "
>AA" #
GenerateQueryAA$ 1
(AA1 2

IQueryableAA2 <
<AA< =
TEntityAA= D
>AAD E
entitiesAAF N
,AAN O

ExpressionAAP Z
<AAZ [
FuncAA[ _
<AA_ `
TEntityAA` g
,AAg h
boolAAi m
>AAm n
>AAn o
funcAAp t
)AAt u
{BB 	
returnCC 
entitiesCC 
.CC 
WhereCC !
(CC! "
funcCC" &
)CC& '
;CC' (
}DD 	
publicFF 
asyncFF 
TaskFF 
<FF 
ICollectionFF %
<FF% &
TReturnFF& -
>FF- .
>FF. /
FilterReadOnlyAsyncFF0 C
<FFC D
TReturnFFD K
>FFK L
(FFL M

ExpressionFFM W
<FFW X
FuncFFX \
<FF\ ]
TEntityFF] d
,FFd e
boolFFf j
>FFj k
>FFk l
funcFFm q
)FFq r
{GG 	
returnHH 
awaitHH 
GenerateQueryHH &
(HH& '
_readonlyEntitiesHH' 8
,HH8 9
funcHH: >
)HH> ?
.HH? @
	ProjectToHH@ I
<HHI J
TReturnHHJ Q
>HHQ R
(HHR S
_configurationHHS a
)HHa b
.HHb c
ToListAsyncHHc n
(HHn o
)HHo p
;HHp q
}II 	
publicKK 
asyncKK 
TaskKK 
<KK 
ICollectionKK %
<KK% &
TEntityKK& -
>KK- .
>KK. /
FilterAsyncKK0 ;
(KK; <

ExpressionKK< F
<KKF G
FuncKKG K
<KKK L
TEntityKKL S
,KKS T
boolKKU Y
>KKY Z
>KKZ [
funcKK\ `
)KK` a
{LL 	
varMM 
queryMM 
=MM 
GenerateQueryMM %
(MM% &
	_entitiesMM& /
,MM/ 0
funcMM1 5
)MM5 6
;MM6 7
foreachOO 
(OO 
varOO 
includeOO  
inOO! #
IncludesOO$ ,
)OO, -
{PP 
queryQQ 
=QQ 
queryQQ 
.QQ 
IncludeQQ %
(QQ% &
includeQQ& -
)QQ- .
;QQ. /
}RR 
returnTT 
awaitTT 
queryTT 
.TT 
ToListAsyncTT *
(TT* +
)TT+ ,
;TT, -
}UU 	
publicWW 
asyncWW 
TaskWW 
AddRangeAsyncWW '
(WW' (
IEnumerableWW( 3
<WW3 4
TEntityWW4 ;
>WW; <
entitiesWW= E
)WWE F
{XX 	
awaitYY 
	_entitiesYY 
.YY 
AddRangeAsyncYY )
(YY) *
entitiesYY* 2
)YY2 3
;YY3 4
awaitZZ 
_contextZZ 
.ZZ 
SaveChangesAsyncZZ +
(ZZ+ ,
)ZZ, -
;ZZ- .
}[[ 	
}\\ 
}]] Ê
VC:\Users\benaz\source\repos\Asp.Core\WebTest\Infrastructure\Persistence\TestContext.cs
	namespace

 	
Infrastructure


 
.

 
Persistence

 $
{ 
public 

class 
TestContext 
: 
IdentityDbContext 0
<0 1
IdentityUser1 =
>= >
,> ?
ITestDbContext@ N
{ 
public 
DbSet 
< 
Person 
> 
Persons $
{% &
get' *
;* +
set, /
;/ 0
}1 2
private !
IDbContextTransaction %
_transaction& 2
;2 3
public 
TestContext 
( 
DbContextOptions +
<+ ,
TestContext, 7
>7 8
options9 @
)@ A
:B C
baseD H
(H I
optionsI P
)P Q
{ 	
} 	
public 
void 
BeginTransaction $
($ %
)% &
{ 	
_transaction 
= 
this 
.  
Database  (
.( )
BeginTransaction) 9
(9 :
): ;
;; <
} 	
public 
void 
CommitTransaction %
(% &
)& '
{ 	
_transaction 
. 
Commit 
(  
)  !
;! "
} 	
public 
void 
RollbackTransaction '
(' (
)( )
{ 	
_transaction 
. 
Rollback !
(! "
)" #
;# $
}   	
	protected"" 
override"" 
void"" 
OnModelCreating""  /
(""/ 0
ModelBuilder""0 <
modelBuilder""= I
)""I J
{## 	
base$$ 
.$$ 
OnModelCreating$$  
($$  !
modelBuilder$$! -
)$$- .
;$$. /
modelBuilder%% 
.%% +
ApplyConfigurationsFromAssembly%% 8
(%%8 9
typeof%%9 ?
(%%? @
TestContext%%@ K
)%%K L
.%%L M
Assembly%%M U
)%%U V
;%%V W
}&& 	
}** 
}++ 